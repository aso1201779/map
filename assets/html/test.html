<html>
<head>
<title>googlemap</title>

<!--スマートフォン用に必要-->
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<!--Map表示・位置情報取得 Google API、位置情報を取得しない場合は最後はfalseでOK-->
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script type="text/javascript">
// watchPosion 現在位置を取得
var lastPoslat,lastPoslng, posHistory,startMarker,currentMarker;
window.onload = function(){
	// 位置情報取得のオプション。高精度にする
	var position_options = {
		enableHightAccuracy: true
	};
	navigator.geolocation.watchPosition(initialize);
}

function initialize(position) {
	var lat = 33.590002;
		lat = position.coords.latitude;
	var lng = 130.420622;
		lng = position.coords.longitude;
	var alt = position.coords.altitude;
	var acc = position.coords.accuracy;
	var alc = position.coords.altitudeAccuracy;
	var hed = position.coords.heading;
	var spd = position.coords.speed;

	//緯度、経度の指定

	var myLatlng = new google.maps.LatLng( lat , lng ); //google map 呼び出し
    var myCenter = myLatlng; //mapの中央を変えたい場合任意の値を入れる
	if(lastPoslat != null && lastPoslng != null){
		if (lastPoslat == lat && lastPoslng == lng) { return; }

	    if (posHistory == null) {
	        posHistory = new google.maps.MVCArray([myLatlng]);
	        new google.maps.Polyline({
	          clickable:   false,
	          map:         gmap,
	          path:        posHistory,
	          strokeColor: '#FFAA00'
	        });
	      } else {
	        posHistory.push(myLatlng);
	      }
	}
	lastPoslat = lat;
	lastPoslng = lng;
	gmap.panTo()

	if (startMarker == null) {
	    startMarker = new google.maps.Marker({
	      map:       gmap,
	      position:  myLatlng,
	      clickable: true,
	      draggable: false,
	      flat:      false,
	      visible:   true
	      animation: google.maps.Animation.DROP
	    });
	  } else {
	    if (currentMarker == null) {
	      currentMarker = new google.maps.Marker({
	        map:       gmap,
	        clickable: true,
	        draggable: false,
	        flat:      false,
	        visible:   true
	      });
	    }
	    currentMarker.setPosition(myLatlng);
	  }
	geocoder.geocode({language: 'ja', location: coord}, function(result){
	    var address = result.select(function(value, index) {
	      return value.types.include('sublocality');
	    }).sort(function(a,b){
	      if (a.address_components.length > b.address_components.length) {
	        return -1;
	      } else if (a.address_components.length < b.address_components.length) {
	        return 1;
	      } else {
	        return 0;
	      }
	    })[0].address_components.reverse().inject('', function(result, value, index){
	      if (!value.types.include('country')) { result += value.long_name; }
	      return result;
	    })
	  });
	//地図オプションの指定
    var myOptions = {
		//ズームレベル
	    zoom: 15,
	    //地図の中心点
	    center: coord,
	    //disableDefaultUI:true, //一旦すべてのUIを無効化
	    //スケールコントロールを有効化
	    scaleControl:true,
	    //スケールコントロールの表示位置
	    scaleControlOptions:{
	    	position: google.maps.ControlPosition.BOTTOM_LEFT
	    },
	    //ストリートビューコントロールを無効化
	    streetViewControl: false,
	    //地図タイプコントロールの無効化
	    mapTypeControl:false,
	    //地図タイプ
	    mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var gmap = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

    //マーカーの表示・設定
	var marker = new google.maps.Marker({
		position: myLatlng,
		map:gmap,
		draggable:false,
		animation: google.maps.Animation.DROP //バウンドさせるにはBOUNCE
	});

	// サークル表示・設定（半径差分）
	var circle = new google.maps.Circle({
		center:myCenter,		//中心座標
		map: gmap,				//円を表示するマップ
		radius: acc,			//地上表面の半径
		strokeWeight: 3,		//外周線の幅
		strokeColor: "#cd5c5c", //外周線の色
		strokeOpacity: 0.5,		//外周線の不透明度
		fillColor: "#e9967a",	//塗りつぶしの色
		fillOpacity: 0.5		//塗りつぶしの不透明度
	});


}

</script>

<style type="text/css">
<!--
html, body {
    margin:0px;
    padding:0px;
    height: 100%;
}
#map_canvas {
    height: 100%;
}
-->
</style>

<body>
<div id="map_canvas"></div>
</body>
